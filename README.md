# JSONL 模块化处理器 - 使用说明文档

## 概述

JSONL 模块化处理器是一个功能强大的前端工具，用于处理 JSONL（JSON Lines）格式的文件。它提供了多个独立的功能模块，用户可以根据需要自由组合这些功能，实现对 JSONL 文件的灵活处理。

## 主要特性

- **模块化设计**：所有功能都拆分为独立模块，用户可以自由选择和组合
- **用户友好界面**：直观的图形界面，操作简单
- **实时反馈**：处理过程中的状态实时显示
- **批量处理**：支持文件切分和批量下载
- **安全性**：纯前端处理，文件不上传到服务器，保护数据隐私

## 功能模块详解

### 1. 日期插入功能

**功能说明**：在每行数据的 `internal_id` 字段最后一个下划线前插入用户选择的日期。

**使用场景**：
- 需要在数据标识中添加时间信息
- 批量更新数据的时间戳
- 数据版本管理

**配置选项**：
- 插入日期：用户可以选择任意日期，默认为当前日期

**处理示例**：
```
原始数据：{"internal_id": "data_001", ...}
处理后：{"internal_id": "data_20241105_001", ...}
```

### 2. Prompt 截断功能

**功能说明**：将每行数据的 `prompt` 字段截断为指定字符数。

**使用场景**：
- 减少数据存储空间
- 隐藏敏感信息
- 简化显示内容

**配置选项**：
- 截断长度：可以设置 1-1000 个字符，默认为 10 个字符

**处理示例**：
```
原始数据：{"prompt": "这是一个很长的提示文本内容..."}
处理后（长度为10）：{"prompt": "这是一个很长的"}
```

### 3. Reference 字段添加功能

**功能说明**：将完整的 `prompt` 内容保存到新增的 `reference` 字段中。

**使用场景**：
- 保留原始数据用于后续处理
- 数据备份和恢复
- 同时需要简化显示和完整内容的场景

**配置选项**：
- 无需额外配置，功能启用后自动处理

**处理示例**：
```
原始数据：{"prompt": "简化的文本"}
处理后：{"prompt": "简化的文本", "reference": "简化的文本"}
```

### 4. 文件切分功能

**功能说明**：按指定行数将处理后的数据切分成多个文件。

**使用场景**：
- 大文件分批处理
- 按批次导入数据
- 控制单次处理的数据量

**配置选项**：
- 每份文件行数：可以设置任意正整数，默认为 100 行

**输出示例**：
```
原始文件：data.jsonl（1000行）
切分后：
- data_part_1.jsonl（100行）
- data_part_2.jsonl（100行）
- ...
- data_part_10.jsonl（100行）
```

### 5. 批量下载功能

**功能说明**：自动下载所有生成的文件。

**使用场景**：
- 批量获取处理结果
- 自动化工作流程
- 避免手动逐个下载

**配置选项**：
- 当启用文件切分功能时，此功能自动启用且不可取消
- 未启用文件切分时，用户可以选择是否启用此功能

## 使用步骤

### 步骤 1：选择文件
1. 点击"选择 JSONL 文件"按钮
2. 在弹出的文件选择对话框中选择要处理的 .jsonl 文件
3. 系统会显示文件名和文件大小信息

### 步骤 2：选择功能模块
1. 在"功能选择"区域勾选需要的功能
2. 每个功能都有详细的说明描述
3. 系统会实时显示已选择的功能列表
4. 某些功能需要配置相关参数（如日期、截断长度等）

### 步骤 3：配置功能参数
根据选择的功能，配置相应的参数：

- **日期插入**：选择要插入的日期
- **Prompt 截断**：设置截断字符数
- **文件切分**：设置每个文件的行数

### 步骤 4：执行处理
1. 确认所有配置无误后，点击"处理并下载"按钮
2. 系统会显示处理进度和状态信息
3. 处理完成后会自动下载生成的文件（如果启用了下载功能）

### 步骤 5：查看处理结果
1. 在状态区域查看处理摘要信息
2. 包含原始文件信息、处理行数、启用功能等详细信息
3. 在下载文件夹中查找生成的文件

## 功能依赖关系

某些功能之间存在逻辑依赖关系：

1. **文件切分 → 批量下载**
   - 当启用文件切分时，批量下载功能自动启用
   - 这是因为切分后的多个文件需要通过批量下载获取

2. **日期插入 → 日期选择**
   - 启用日期插入功能时，必须选择插入日期

3. **Prompt 截断 → 截断长度**
   - 启用 Prompt 截断功能时，必须设置截断长度

4. **文件切分 → 切分行数**
   - 启用文件切分功能时，必须设置每份文件的行数

## 使用技巧

### 常用功能组合

1. **标准处理组合**
   - 日期插入 + Reference 字段添加 + Prompt 截断 + 文件切分
   - 适用于：需要标准化处理大量数据并分批导入的场景

2. **简单处理组合**
   - Prompt 截断 + Reference 字段添加
   - 适用于：只需要修改字段内容，不需要切分文件的场景

3. **仅数据修改组合**
   - 日期插入
   - 适用于：只需要更新时间戳的场景

4. **数据整理组合**
   - Reference 字段添加 + 文件切分
   - 适用于：需要保留原始数据并分批处理的场景

### 注意事项

1. **文件格式**：确保上传的文件是有效的 JSONL 格式（每行一个 JSON 对象）
2. **字段要求**：
   - 日期插入功能要求每行数据有 `internal_id` 字段
   - Prompt 相关功能要求每行数据有 `prompt` 字段
3. **性能考虑**：大文件处理可能需要较长时间，建议分批处理
4. **浏览器兼容性**：建议使用现代浏览器（Chrome、Firefox、Safari、Edge）

## 错误处理

### 常见错误及解决方案

1. **文件读取失败**
   - 检查文件是否损坏
   - 确认文件格式是否为 .jsonl
   - 尝试重新选择文件

2. **JSON 解析失败**
   - 检查文件内容是否每行都是有效的 JSON 对象
   - 注意空行和格式错误
   - 系统会提示具体出错的行号

3. **参数验证失败**
   - 日期插入：请选择有效日期
   - Prompt 截断：请输入有效的截断长度（大于0的整数）
   - 文件切分：请输入有效的切分行数（大于0的整数）

4. **功能选择错误**
   - 请至少选择一个功能模块
   - 检查相关参数是否已正确配置

## 技术规格

### 支持的文件格式
- **文件扩展名**：.jsonl
- **内容格式**：每行一个 JSON 对象
- **文件大小**：理论上无限制，实际受浏览器内存限制影响

### 性能指标
- **处理速度**：约 1000-5000 行/秒（取决于数据复杂度）
- **内存使用**：约为文件大小的 2-3 倍
- **并发处理**：不支持，单文件顺序处理

### 浏览器兼容性
- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+

## 更新日志

### v2.0.0 - 模块化版本
- ✨ 新增：模块化功能设计
- ✨ 新增：功能自由组合
- ✨ 新增：可配置的截断长度
- ✨ 新增：实时功能状态显示
- 🔧 改进：用户界面优化
- 🔧 改进：错误处理增强

### v1.0.0 - 初始版本
- ✨ 基础功能：日期插入、Prompt截断、Reference字段添加
- ✨ 文件切分功能
- ✨ 批量下载功能

## 支持与反馈

如果您在使用过程中遇到问题或有功能建议，请：

1. 检查本文档中的常见错误解决方案
2. 确认浏览器版本是否满足要求
3. 尝试使用较小的测试文件验证功能
4. 记录具体的错误信息和操作步骤

---

**版本**：2.0.0
**更新日期**：2024年11月5日
**文档类型**：用户使用手册