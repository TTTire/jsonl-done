<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONL 工具箱</title>
    <link rel="icon" href="icon.jpg">
    <link rel="stylesheet" href="css/main.css">
</head>
    <body>
        <div class="container">
            <h1>JSONL 工具箱</h1>

            <!-- 文件选择区域 -->
            <div class="section">
                <div class="section-title">
                    <div class="section-icon">1</div>
                    文件选择
                </div>
                <div class="input-group">
                    <label for="fileInput">选择 JSONL 文件：</label>
                    <input type="file" id="fileInput" accept=".jsonl" />
                </div>
            </div>

            <!-- 功能选择区域 -->
            <div class="section">
                <div class="section-title">
                    <div class="section-icon">2</div>
                    功能选择
                </div>

                <div class="checkbox-group">
                    <!-- 日期插入功能 -->
                    <div class="checkbox-item" data-function="dateInsert">
                        <input type="checkbox" id="dateInsert" checked>
                        <div class="checkbox-content">
                            <div class="checkbox-title">日期插入</div>
                            <div class="checkbox-description">在 internal_id 字段最后一个下划线前插入用户选择的日期</div>
                        </div>
                    </div>
                    <div class="checkbox-dependency" id="dateInsertSettings">
                        <label for="dateInput">选择插入日期：</label>
                        <input type="date" id="dateInput" />
                    </div>

                    <!-- Prompt截断功能 -->
                    <div class="checkbox-item" data-function="promptTruncate">
                        <input type="checkbox" id="promptTruncate" checked>
                        <div class="checkbox-content">
                            <div class="checkbox-title">Prompt截断</div>
                            <div class="checkbox-description">将 prompt 字段截断为指定字符数</div>
                        </div>
                    </div>
                    <div class="checkbox-dependency" id="promptTruncateSettings">
                        <label for="truncateLengthInput">截断长度（字符数）：</label>
                        <input type="number" id="truncateLengthInput" value="10" min="1" max="1000" />
                    </div>

                    <!-- Reference字段添加功能 -->
                    <div class="checkbox-item" data-function="referenceField">
                        <input type="checkbox" id="referenceField" checked>
                        <div class="checkbox-content">
                            <div class="checkbox-title">Reference字段添加</div>
                            <div class="checkbox-description">将完整的 prompt 内容保存到 reference 字段</div>
                        </div>
                    </div>

                    <!-- 文件切分功能 -->
                    <div class="checkbox-item" data-function="fileSplit">
                        <input type="checkbox" id="fileSplit" checked>
                        <div class="checkbox-content">
                            <div class="checkbox-title">文件切分</div>
                            <div class="checkbox-description">按指定行数将处理后的数据切分成多个文件</div>
                        </div>
                    </div>
                    <div class="checkbox-dependency" id="fileSplitSettings">
                        <label for="splitCountInput">每份文件的行数：</label>
                        <input type="number" id="splitCountInput" placeholder="每份文件的行数..." min="1" value="100" />
                    </div>

                    <!-- 批量下载功能 -->
                    <div class="checkbox-item" data-function="batchDownload">
                        <input type="checkbox" id="batchDownload" checked>
                        <div class="checkbox-content">
                            <div class="checkbox-title">批量下载</div>
                            <div class="checkbox-description">自动下载所有生成的文件（此功能在文件切分启用时自动启用）</div>
                        </div>
                    </div>

                    <!-- 数据行大小过滤功能 -->
                    <div class="checkbox-item" data-function="rowSizeFilter">
                        <input type="checkbox" id="rowSizeFilter">
                        <div class="checkbox-content">
                            <div class="checkbox-title">数据行大小过滤</div>
                            <div class="checkbox-description">过滤掉超过指定大小（MB）的数据行，输出保留和过滤两个文件</div>
                        </div>
                    </div>
                    <div class="checkbox-dependency" id="rowSizeFilterSettings" style="display: none;">
                        <label for="maxRowSizeInput">大小阈值（MB）：</label>
                        <input type="number" id="maxRowSizeInput" value="1" min="0.001" step="0.001" />
                    </div>

                    <!-- Prompt 长度过滤功能 -->
                    <div class="checkbox-item" data-function="promptLengthFilter">
                        <input type="checkbox" id="promptLengthFilter">
                        <div class="checkbox-content">
                            <div class="checkbox-title">Prompt 长度过滤</div>
                            <div class="checkbox-description">过滤掉 prompt 字段超过 20480 字节的数据行，输出保留和过滤两个文件</div>
                        </div>
                    </div>
                </div>

                <!-- 已选择功能显示 -->
                <div class="selected-functions" id="selectedFunctions" style="display: none;">
                    <div class="selected-functions-title">已选择的功能：</div>
                    <div id="selectedFunctionsList"></div>
                </div>
            </div>

            <button id="processButton">处理并下载</button>

            <div id="statusArea"></div>
        </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
