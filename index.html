<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONL 工具箱</title>
    <link rel="icon" href="icon.jpg">
    <link rel="stylesheet" href="css/main.css?v=20250130">
</head>
<body>
    <!-- 主题切换按钮 -->
    <button id="themeToggle" class="theme-toggle" aria-label="切换主题" title="切换主题">
        <svg class="theme-icon theme-icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="19"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg class="theme-icon theme-icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 1-21-12.79z"></path>
        </svg>
        <svg class="theme-icon theme-icon-bulb" viewBox="0 0 1024 1024" fill="currentColor">
            <path d="M512.051944 0.000347a364.040555 364.040555 0 0 0-364.474452 362.860352c0 84.072107 45.941137 166.616893 90.389664 246.454153a859.326624 859.326624 0 0 1 61.405267 124.684975c12.895453 35.961479 22.823043 69.215434 31.587786 98.581662C362.999249 939.493995 388.165342 1024 512.051944 1024s149.087407-84.245666 181.022312-190.91519c8.677963-29.244736 18.674977-62.377199 31.622498-98.390746a873.975026 873.975026 0 0 1 61.214352-124.459347c44.500595-80.201736 90.511156-163.145707 90.511155-247.356662A364.040555 364.040555 0 0 0 512.051944 0.000347z m0 954.454456c-35.996191 0-56.528252-8.851522-72.686619-32.97626h145.49473c-16.175723 24.142094-36.72514 32.993616-72.808111 32.993616z m96.446883-85.044039H415.743909a928.507346 928.507346 0 0 1-5.762167-17.355926h204.296608c-1.978576 6.109286-3.887727 11.854098-5.779523 17.33857z m21.451925-68.6774a26.172737 26.172737 0 0 0-6.213422-0.833085H394.101069c-3.349694-11.142505-6.820879-22.562704-10.639183-34.711852H640.867629c-3.939795 12.35742-7.49776 24.124738-10.916877 35.527581z m94.867493-224.082365a1081.170074 1081.170074 0 0 0-59.565539 118.992231H359.198301a1057.11476 1057.11476 0 0 0-60.103573-120.050942c-40.126902-72.079162-81.572854-146.60551-81.572853-212.696877a294.582137 294.582137 0 0 1 589.146919 0c-0.052068 66.264927-41.619511 141.225172-81.850549 213.738232zM500.371406 142.839621A215.66474 215.66474 0 0 0 284.51575 357.792768a34.902768 34.902768 0 0 0 69.805536 0 145.911273 145.911273 0 0 1 146.05012-145.442662 34.76392 34.76392 0 1 0 0-69.527841z"></path>
        </svg>
    </button>

    <!-- 应用包装器 -->
    <div class="app-wrapper" id="appWrapper">
        <!-- 左侧边栏：文件选择 -->
        <aside class="file-sidebar" id="fileSidebar">
            <div class="sidebar-content">
                <h1>JSONL 工具箱</h1>

                <!-- 文件选择区域 -->
                <div class="section" id="fileSection">
                    <div class="section-title">
                        <div class="section-icon">1</div>
                        文件选择
                    </div>
                    <div class="input-group">
                        <label for="fileInput">选择 JSONL 文件：</label>
                        <input type="file" id="fileInput" accept=".jsonl" />
                    </div>
                </div>
            </div>
        </aside>

        <!-- 主内容区：功能选择 -->
        <main class="main-content" id="mainContent">
            <!-- 功能选择区域 -->
            <div class="section" id="functionSection" style="display: none;">
                <div class="section-title">
                    <div class="section-icon">2</div>
                    功能选择
                </div>

                <div class="checkbox-group">
                    <!-- 日期插入功能 -->
                    <div class="checkbox-item" data-function="dateInsert">
                        <input type="checkbox" id="dateInsert">
                        <div class="checkbox-content">
                            <div class="checkbox-title">日期插入</div>
                            <div class="checkbox-description">在 internal_id 字段最后一个下划线前插入用户选择的日期</div>
                        </div>
                    </div>
                    <div class="checkbox-dependency" id="dateInsertSettings">
                        <label for="dateInput">选择插入日期：</label>
                        <input type="date" id="dateInput" />
                    </div>

                    <!-- Prompt截断功能 -->
                    <div class="checkbox-item" data-function="promptTruncate">
                        <input type="checkbox" id="promptTruncate">
                        <div class="checkbox-content">
                            <div class="checkbox-title">Prompt截断</div>
                            <div class="checkbox-description">将 prompt 字段截断为指定字符数</div>
                        </div>
                    </div>
                    <div class="checkbox-dependency" id="promptTruncateSettings">
                        <label for="truncateLengthInput">截断长度（字符数）：</label>
                        <input type="number" id="truncateLengthInput" value="10" min="1" max="1000" />
                    </div>

                    <!-- Reference字段添加功能 -->
                    <div class="checkbox-item" data-function="referenceField">
                        <input type="checkbox" id="referenceField">
                        <div class="checkbox-content">
                            <div class="checkbox-title">Reference字段添加</div>
                            <div class="checkbox-description">将完整的 prompt 内容保存到 reference 字段</div>
                        </div>
                    </div>

                    <!-- 文件切分功能 -->
                    <div class="checkbox-item" data-function="fileSplit">
                        <input type="checkbox" id="fileSplit">
                        <div class="checkbox-content">
                            <div class="checkbox-title">文件切分</div>
                            <div class="checkbox-description">按指定行数将处理后的数据切分成多个文件</div>
                        </div>
                    </div>
                    <div class="checkbox-dependency" id="fileSplitSettings">
                        <label for="splitCountInput">每份文件的行数：</label>
                        <input type="number" id="splitCountInput" placeholder="每份文件的行数..." min="1" value="100" />
                    </div>

                    <!-- 数据行大小过滤功能 -->
                    <div class="checkbox-item" data-function="rowSizeFilter">
                        <input type="checkbox" id="rowSizeFilter">
                        <div class="checkbox-content">
                            <div class="checkbox-title">数据行大小过滤</div>
                            <div class="checkbox-description">过滤掉超过指定大小（MB）的数据行，输出保留和过滤两个文件</div>
                        </div>
                    </div>
                    <div class="checkbox-dependency" id="rowSizeFilterSettings" style="display: none;">
                        <label for="maxRowSizeInput">大小阈值（MB）：</label>
                        <input type="number" id="maxRowSizeInput" value="1" min="0.001" step="0.001" />
                    </div>

                    <!-- Prompt 长度过滤功能 -->
                    <div class="checkbox-item" data-function="promptLengthFilter">
                        <input type="checkbox" id="promptLengthFilter">
                        <div class="checkbox-content">
                            <div class="checkbox-title">Prompt 长度过滤</div>
                            <div class="checkbox-description">过滤掉 prompt 字段超过 20480 字节的数据行，输出保留和过滤两个文件</div>
                        </div>
                    </div>

                    <!-- 字段编辑功能 -->
                    <div class="checkbox-item" data-function="fieldEditor">
                        <input type="checkbox" id="fieldEditorToggle">
                        <div class="checkbox-content">
                            <div class="checkbox-title">字段编辑</div>
                            <div class="checkbox-description">启用字段拖拽排序、重命名、删除和新增功能</div>
                        </div>
                    </div>
                </div>

                <!-- 已选择功能显示 -->
                <div class="selected-functions" id="selectedFunctions" style="display: none;">
                    <div class="selected-functions-title">已选择的功能：</div>
                    <div id="selectedFunctionsList"></div>
                </div>
            </div>

            <!-- 字段编辑区域 -->
            <div class="section field-editor-section" id="fieldEditorSection" style="display: none;">
                <div class="section-title">
                    <div class="section-icon">3</div>
                    字段编辑
                    <button id="addFieldBtn" class="icon-btn" title="新增字段">+</button>
                </div>

                <!-- 字段统计信息 -->
                <div class="field-stats">
                    共 <span id="fieldCount">0</span> 个字段
                </div>

                <!-- 字段列表容器 -->
                <div class="field-list" id="fieldList">
                    <!-- 字段卡片将通过 JS 动态生成 -->
                </div>

                <!-- 操作按钮 -->
                <div class="field-actions">
                    <button id="resetFieldsBtn" class="secondary-btn">重置字段</button>
                </div>
            </div>

            <button id="processButton" style="display: none;">处理并下载</button>

            <div id="statusArea"></div>
        </main>
    </div>

    <script type="module" src="js/main.js?v=20250130"></script>
</body>
</html>
